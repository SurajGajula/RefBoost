# RefBoost - Serverless Referral Tracking System

RefBoost is a comprehensive referral tracking system built using AWS Lambda functions for serverless backend operations. This application enables businesses to create and manage referral campaigns while allowing affiliates to join campaigns and track their performance.

## Architecture Overview

RefBoost leverages a serverless architecture using AWS Lambda functions for all backend operations, with static frontend hosting and secure data storage.

### Technology Stack
- **Backend**: AWS Lambda (Node.js)
- **Frontend**: HTML, CSS, TypeScript
- **Storage**: Amazon S3
- **Hosting**: AWS Amplify
- **API Gateway**: AWS API Gateway for Lambda function endpoints

## AWS Lambda Functions

The application consists of 14 AWS Lambda functions, each handling specific business logic in a serverless architecture:

### Authentication Functions

#### 1. `signin` - User Authentication
- **Purpose**: Handles user login authentication
- **Method**: POST
- **Features**: Secure credential validation and session management

#### 2. `signup` - User Registration
- **Purpose**: Handles new user registration
- **Method**: POST
- **Features**: User data validation and account creation

### Account Management Functions

#### 3. `storeaccounttype` - Store User Account Type
- **Purpose**: Stores whether user is a campaign 'owner' or 'affiliate'
- **Method**: POST
- **Features**: Account type persistence for proper dashboard routing

#### 4. `loadaccounttype` - Load User Account Type
- **Purpose**: Retrieves user's account type for dashboard routing
- **Method**: POST
- **Features**: Fast account type lookup and role-based access

### Campaign Management Functions

#### 5. `storecampaigns` - Create Campaign
- **Purpose**: Allows campaign owners to create new referral campaigns
- **Method**: POST
- **Features**: Campaign data validation and storage

#### 6. `loadcampaigns` - Load User's Campaigns
- **Purpose**: Retrieves campaigns owned by a specific user
- **Method**: POST
- **Features**: User-specific campaign filtering and data retrieval

#### 7. `loadallcampaigns` - Load All Active Campaigns
- **Purpose**: Retrieves all active campaigns for affiliates to browse
- **Method**: POST
- **Features**: Campaign discovery and filtering by status

#### 8. `deletecampaign` - Delete Campaign
- **Purpose**: Allows campaign owners to delete their campaigns
- **Method**: POST
- **Features**: Secure campaign deletion with ownership validation

### Referral Code Management Functions

#### 9. `storecodes` - Store Referral Codes
- **Purpose**: Stores referral codes generated by affiliates
- **Method**: POST
- **Features**: Unique code generation and storage

#### 10. `loadcodes` - Load User's Referral Codes
- **Purpose**: Retrieves referral codes owned by a specific affiliate
- **Method**: POST
- **Features**: Performance tracking and analytics data

#### 11. `loadallcodes` - Load All Referral Codes
- **Purpose**: Retrieves all referral codes for system operations
- **Method**: POST
- **Features**: System-wide referral code management

#### 12. `deletecode` - Delete Referral Code
- **Purpose**: Removes referral codes when affiliates leave campaigns
- **Method**: POST
- **Features**: Clean data removal and integrity maintenance

### Advanced Campaign Functions

#### 13. `joincampaign` - Join Campaign (Atomic Operation)
- **Purpose**: Handles affiliate joining campaigns with atomic updates
- **Method**: POST
- **Key Features**:
  - Atomically updates both affiliate and campaign owner data
  - Ensures data consistency across all related records
  - Adds affiliate to campaign participants
  - Creates referral tracking entries
  - Generates unique referral links

#### 14. `trackconversion` - Track Conversions
- **Purpose**: Tracks when referrals convert to actual signups/sales
- **Method**: POST
- **Key Features**:
  - Real-time conversion tracking
  - Updates affiliate performance statistics
  - Updates campaign owner analytics
  - Maintains detailed referral audit trails

## Lambda Function Architecture

### Serverless Design Patterns

All Lambda functions follow consistent serverless design patterns:

1. **Stateless Operations**: Each function operates independently without server state
2. **Event-Driven Processing**: Functions respond to HTTP requests via API Gateway
3. **Auto-Scaling**: Automatically scales based on demand without configuration
4. **CORS Support**: Comprehensive CORS headers for web application integration
5. **Error Handling**: Robust error handling with appropriate HTTP status codes
6. **Input Validation**: Validates all inputs before processing
7. **Secure Storage**: Encrypted data storage with AWS S3 integration

### Example Lambda Function Structure

```javascript
exports.handler = async (event) => {
  // CORS headers for web application integration
  const headers = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Headers': 'Content-Type',
    'Access-Control-Allow-Methods': 'POST,OPTIONS',
    'Content-Type': 'application/json'
  };

  // Handle preflight requests
  if (event.httpMethod === 'OPTIONS') {
    return { statusCode: 200, headers, body: JSON.stringify({ message: 'CORS preflight check passed' }) };
  }

  try {
    // Input validation
    const body = JSON.parse(event.body);
    if (!body.requiredField) {
      return { statusCode: 400, headers, body: JSON.stringify({ message: 'Missing required field' }) };
    }

    // Business logic processing
    const result = await processBusinessLogic(body);
    
    // Return success response
    return { statusCode: 200, headers, body: JSON.stringify(result) };
  } catch (error) {
    console.error('Function error:', error);
    return { statusCode: 500, headers, body: JSON.stringify({ message: 'Internal server error' }) };
  }
};
```

## Data Flow Architecture

### User Registration & Authentication Flow
1. **User Registration**: New users sign up through the `signup` Lambda function
2. **Account Type Selection**: Users choose between campaign owner or affiliate roles via `storeaccounttype`
3. **Authentication**: Returning users authenticate through the `signin` Lambda function
4. **Dashboard Routing**: Account type is retrieved via `loadaccounttype` for proper dashboard access

### Campaign Lifecycle Flow

#### For Campaign Owners:
1. **Campaign Creation**: Owners create campaigns using the `storecampaigns` Lambda function
2. **Campaign Management**: View and manage campaigns through `loadcampaigns`
3. **Performance Tracking**: Monitor affiliate participation and conversions
4. **Campaign Deletion**: Remove campaigns via `deletecampaign` when needed

#### For Affiliates:
1. **Campaign Discovery**: Browse available campaigns using `loadallcampaigns`
2. **Campaign Joining**: Join campaigns through the `joincampaign` atomic operation
3. **Referral Generation**: Receive unique referral links and tracking codes
4. **Performance Monitoring**: Track clicks and conversions via `loadcodes`

### Conversion Tracking Flow
1. **Link Sharing**: Affiliates share their unique referral links
2. **Click Tracking**: System logs clicks on referral links
3. **Conversion Recording**: When signups occur, `trackconversion` updates all relevant data
4. **Real-time Analytics**: Both affiliates and campaign owners see updated statistics

## Serverless Architecture Benefits

### Scalability
- **Automatic Scaling**: Lambda functions scale automatically based on demand
- **No Capacity Planning**: No need to provision servers or predict traffic
- **Global Distribution**: Functions can be deployed across multiple AWS regions

### Cost Efficiency
- **Pay-per-Use**: Only pay for actual function execution time
- **No Idle Costs**: No charges when functions aren't running
- **Micro-billing**: Charged in 1ms increments for precise cost control

### Performance
- **Fast Cold Starts**: Optimized Node.js runtime for quick initialization
- **Concurrent Execution**: Multiple function instances handle parallel requests
- **Low Latency**: Direct integration with AWS services reduces network overhead

### Reliability
- **Built-in Redundancy**: AWS manages infrastructure reliability automatically
- **Error Isolation**: Function failures don't affect other operations
- **Automatic Recovery**: Failed executions are automatically retried

### Development Efficiency
- **No Server Management**: Focus on business logic instead of infrastructure
- **Rapid Deployment**: Quick iteration cycles for feature development
- **Version Control**: Built-in function versioning and rollback capabilities

## Security Features

- **CORS Configuration**: Proper cross-origin resource sharing for web security
- **Input Validation**: All functions validate inputs to prevent malicious requests
- **Encrypted Storage**: All data is encrypted at rest and in transit
- **IAM Permissions**: Functions operate with minimal required permissions
- **API Gateway Integration**: Centralized API management with throttling and monitoring

## Monitoring & Analytics

- **CloudWatch Integration**: Comprehensive logging and monitoring
- **Performance Metrics**: Function execution time, error rates, and invocation counts
- **Custom Metrics**: Business-specific tracking for referral performance
- **Real-time Dashboards**: Live monitoring of system health and usage

## Why Lambda for Referral Tracking?

RefBoost chose AWS Lambda for several key advantages in referral tracking:

1. **Event-Driven Nature**: Referral events (clicks, signups, conversions) are naturally event-driven
2. **Variable Traffic**: Referral campaigns can have unpredictable traffic spikes
3. **Cost Optimization**: Pay only for actual referral processing, not idle server time
4. **Global Scale**: Easily deploy across regions for worldwide referral tracking
5. **Integration**: Seamless integration with other AWS services for analytics and storage
6. **Maintenance-Free**: No server patching, scaling, or infrastructure management required

This serverless architecture enables RefBoost to provide reliable, scalable referral tracking while maintaining optimal cost efficiency and performance. 